<div class="noise"></div>
<ion-header class="daily-journal-header">
    <div class="title-container">
        <div class="title">My Daily Journal </div>
        <div class="flex gap-2">
            <ion-icon (click)="handleSearch()" name="search-outline"></ion-icon>
            <div class="img"></div>
        </div>
    </div>
</ion-header>

<ion-content class="main">
    <ion-fab horizontal="end" vertical="bottom" slot="fixed">
        <ion-fab-button (click)="handleFormMoment()">
            <ion-icon name="add"></ion-icon>
        </ion-fab-button>
    </ion-fab>

    <div class="content_container">
        <div class="row-one">
            <div class="container-journal">

                <div class="col-container">
                    <button class="ellipse-one" (click)="handleFormMd()">
                        <div class="ellipse-two">
                            <div class="icon create"></div>
                        </div>
                    </button>
                    <p>Add New</p>
                </div>

                <div class="col-container" *ngFor="let item of allMd; let i = index">
                    <button (click)="openView(item)">
                        <div class="ellipse-one">
                            <div class="ellipse-two">
                                <div class="icon sun">
                                    <img [src]="item.image" [alt]="item.title">
                                </div>
                            </div>
                        </div>
                    </button>
                    <p>
                        {{item.title}}
                    </p>
                </div>

            </div>
        </div>
        <div class="row-two">
            <div class="container-mood">
                <div class="row-md-1">
                    <h3>weekly mood</h3>
                    <p>Third Week of Nov 22, 2024</p>
                </div>
                <div class="row-md-2">

                    <div class="container">
                        <div class="col-container-mood" *ngFor="let day of daysOfWeek">
                            <div class="ellipse-one">
                                <div class="ellipse-two flex items-center justify-center">
                                    <ion-button [id]="day" class="h-full w-full mood" (click)="openPopup(day)"
                                        #moodButton>
                                        <div *ngFor="let item of allMoods; let i = index">
                                            <span *ngIf="item.day === day">
                                                {{item.mood}}
                                            </span>
                                        </div>
                                        <ion-icon *ngIf="!hasMood(day)" name="add"></ion-icon>
                                    </ion-button>
                                </div>
                            </div>
                            <p>{{day}}</p>

                            <ion-popover [trigger]="day" side="top" alignment="center" [dismissOnSelect]="true">
                                <ng-template>
                                    <ion-content class="ion-padding flex flex-row emoji">
                                        <span (click)="saveMood('ðŸ˜Š', day)" class="flex flex-col gap-1">
                                            <span>ðŸ˜Š</span>
                                            <p class="text-xs">Happy</p>
                                        </span>
                                        <span (click)="saveMood('ðŸ˜¢', day)" class="flex flex-col gap-1">
                                            <span>ðŸ˜¢</span>
                                            <p class="text-xs">Sad</p>
                                        </span>
                                        <span (click)="saveMood('ðŸ˜¡', day)" class="flex flex-col gap-1">
                                            <span>ðŸ˜¡</span>
                                            <p class="text-xs">Angry</p>
                                        </span>
                                        <span (click)="saveMood('ðŸ˜”', day)" class="flex flex-col gap-1">
                                            <span>ðŸ˜”</span>
                                            <p class="text-xs">Lonely</p>
                                        </span>
                                        <span (click)="saveMood('ðŸ˜´', day)" class="flex flex-col gap-1">
                                            <span>ðŸ˜´</span>
                                            <p class="text-xs">Tired</p>
                                        </span>
                                        <span (click)="saveMood('ðŸ˜ƒ', day)" class="flex flex-col gap-1">
                                            <span>ðŸ˜ƒ</span>
                                            <p class="text-xs">Excited</p>
                                        </span>
                                        <span (click)="saveMood('ðŸ˜¨', day)" class="flex flex-col gap-1">
                                            <span>ðŸ˜¨</span>
                                            <p class="text-xs">Afraid</p>
                                        </span>
                                    </ion-content>
                                </ng-template>
                            </ion-popover>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row-three gap-2">
            <div class="moment-rw-one">
                <h1>Moment of the Day</h1>
            </div>

            <div class="moment-rw-two">

                <div class="container" *ngFor="let item of momentsToday; let i = index">
                    <div class="child-rw-one">
                        <div class="child-container">
                            <div class="box">
                                <p>{{ item.dayOfWeek }}</p>

                                <span>{{ item.dayOfMonth }}</span>
                            </div>
                            <p class="time">{{item.hours}}:{{item.minutes}} {{item.amPm}}</p>
                        </div>
                    </div>
                    <div class="child-rw-two">
                        <div class="small-title">
                            {{item.title}}
                        </div>
                        <div class="description">
                            {{item.description}}
                        </div>
                    </div>

                    <div class="child-rw-three">
                        <img [src]="item.image" [alt]="item.title">
                    </div>
                </div>

            </div>
        </div>
        <div class="row-four">
            <div *ngFor="let group of groupedMomentsArray" class="container-old-moment">
                <div class="row-old-title flex justify-start items-center p-2">
                    <p>{{ group.month }} {{ group.year }}</p>
                </div>
                <div class="row-old-content">
                    <div class="child-container border-t-2 border-b-2 border-gray-300"
                        *ngFor="let item of group.moments">
                        <div class="box">
                            <p>{{ item.dayOfWeek }}</p>
                            <span>{{ item.dayOfMonth }}</span>
                        </div>
                        <div class="text-container">
                            <div class="small-title">{{ item.title }}</div>
                            <div class="description">{{ item.description }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="row-five flex flex-col gap-2 mt-5">

            <div class="title-button">

                <p>My Achivements</p>
                <div class="wrapper">
                    <button (click)="handleFormAchievements()">
                        <div class="icon"></div>
                    </button>
                </div>

            </div>
            <div class="container-content-5 flex flex-col h-full max-h-[65vh] overflow-y-auto p-2">

                <div class="box-5" *ngFor="let item of allAchievements; let i = index">

                    <div class="date">
                        <p>{{item.month}} {{item.dayOfMonth}}, {{item.year}} - {{item.dayOfWeek}}</p>
                        <span>{{item.hours}}:{{item.minutes}} {{item.amPm}}</span>
                    </div>

                    <div class="description">{{item.description}}</div>
                    <div class="image">
                        <div class="wrapper">
                            <img [src]="item.image" [alt]="item.title">
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <div class="row-six">



            <div class="container-qoutes">
                <div class="title-button">

                    <p>Inspirational Quotes</p>
                    <div class="wrapper">
                        <button (click)="handleFormInspiration()">
                            <div class="icon"></div>
                        </button>
                    </div>

                </div>


                <div class="container-content">

                    <div class="container-item">

                        <div class="box" *ngFor="let item of allInspiration; let i = index">

                            <div class="date">
                                <p>{{item.month}} {{item.dayOfMonth}}, {{item.year}} - {{item.dayOfWeek}}</p>
                                <span>{{item.hours}}:{{item.minutes}} {{item.amPm}}</span>
                            </div>

                            <div class="description2">{{item.description}}</div>
                            <div class="image">
                                <div class="wrapper"></div>
                                <div class="pr-2 flex flex-row gap-2">
                                    <button (click)="showDeleteConfirmation(item.id)">
                                        <ion-icon name="trash-outline" class="text-red-500"></ion-icon>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>


    <ion-alert [isOpen]="isAlertOpen" header="Are you sure you want to delete this?" [buttons]="alertButtons"
        (didDismiss)="handleDeleteInspiration($event)">
    </ion-alert>

</ion-content>

@if(isMdFormOpen) {
    <MdForm (handleClose)="handleFormMd()" (handleSubmit)="handleSubmitMd($event)"></MdForm>
}

@if(isMomentFormOpen) {
    <FormMoment (handleClose)="handleFormMoment()" (handleSubmit)="handleSubmitMoment($event)"></FormMoment>
}

@if(isAchievementFormOpen) {
    <FormAchievements (handleClose)="handleFormAchievements()" (handleSubmit)="handleSubmitAchievement($event)">
    </FormAchievements>
}
@if(isInspirationFormOpen) {
    <FormInspiration (handleClose)="handleFormInspiration()" (handleSubmit)="handleSubmitInspiration($event)">
    </FormInspiration>
}

@if(isOpenView) {
    <ViewMd [data]="selectedMd" (handleClose)="handleCloseMd()" (handleDelete)="handleDelete($event)"></ViewMd>
}